<!DOCTYPE html>
<html>
<head>
	<?php include 'html_head.php'; ?>
</head>

<body>
	<?php include 'topmenu.php'; ?>

	<div class="adjustmentsWrap">
		<div class="adjustmentsCatsListWrap show-for-large">
			<ul class="adjustmentsCatsList grid-x">
				<li class="goto-one current">高度調整</li>
				<li class="goto-two">貼身照護</li>
				<li class="goto-three">兒童床</li>
			</ul>

			<div class="top is-hide"><img src="images/adjustments-top.svg"></div>
		</div>
		
		<main id="fullpage">
			<section class="section">
				<div class="items-area grid-x">
					<div class="pic-area cell large-auto grid-x align-center-middle">
						<div class="head-area first hide-for-large">
							<div class="ch text-rd-ch">功能調整</div>
							<div class="en text-rd-en">
								MULTI- PURPOSE<br>
								ADJUSTMENTS
							</div>
						</div>
						<div class="pic">
							<div class="item">
								<div class="adjustments-slider first"></div>
							</div>
						</div>
					</div>
					<div class="article-area first cell large-auto grid-x">
						<div class="">
							<div class="head-area show-for-large">
								<div class="ch text-rd-ch"  data-delay=".75">功能調整</div>
								<div class="en text-rd-en"  data-delay=".75">
									MULTI- PURPOSE<br>
									ADJUSTMENTS
								</div>
							</div>
							<ul class="adjustmentsCats grid-x align-center">
								<li class="grid-x align-middle goto-one">
									<div class="text">高度調整</div>
									<div><img src="images/adjustments-arrow.svg"></div>
								</li>
								<li class="grid-x align-middle goto-two">
									<div class="text">貼身照顧</div>
									<div><img src="images/adjustments-arrow.svg"></div>
								</li>
								<li class="grid-x align-middle goto-three">
									<div class="text">兒童床</div>
									<div><img src="images/adjustments-arrow.svg"></div>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</section>

			<section class="section">
				<div class="items-area grid-x">
					<div class="pic-area cell large-auto grid-x align-center-middle">
						<div class="head-area hide-for-large">
							<div class="ch text-rd-ch">高度調整</div>
							<div class="en text-rd-en">
								HEIGHT ADJUSTMENTS
							</div>
						</div>
						<div class="pic">
							<div class="item">
								<div class="adjustments-slider"></div>
							</div>

							<ul class="adjustments-in-dots grid-x align-center-middle"></ul>

							<div class="prev"><img src="images/adjustments-prev.svg"></div>
							<div class="next"><img src="images/adjustments-next.svg"></div>
						</div>
					</div>
					<div class="article-area cell large-auto">
						<div class="grid-y">
							<div class="head-area show-for-large">
								<div class="ch">高度調整</div>
								<div class="en">
									HEIGHT<br>
									ADJUSTMENTS
								</div>
							</div>
							<div class="content large-order-1 small-order-2">隨著寶寶會翻身、會坐起、會站立的不同時間段，爸爸媽媽要特別注意調整床墊相應的高度，以確保寶寶無翻落風險。</div>
							<div class="title large-order-2 small-order-1">
								<ul class="title-list">
									<li class="current">0~6個月</li>
									<li>6~24個月</li>
									<li>拆卸護欄x4顆螺絲50mm</li>
									<li>拆卸床板x4顆螺絲38mm</li>
									<li>調整高度</li>
									<li>固定床板x4顆螺絲38mm</li>
									<li>固定護欄x4顆螺絲50mm</li>
									<li></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</section>

			<section class="section">
				<div class="items-area grid-x">
					<div class="pic-area cell large-auto grid-x align-center-middle">
						<div class="head-area hide-for-large">
							<div class="ch">貼身照顧</div>
							<div class="en">
								BEDSIDE CARE
							</div>
							</div>
						<div class="pic">
							<div class="item">
								<div class="adjustments-slider"></div>
							</div>
							<ul class="adjustments-in-dots white grid-x align-center-middle"></ul>

							<div class="prev"><img src="images/adjustments-prev.svg"></div>
							<div class="next"><img src="images/adjustments-next.svg"></div>
						</div>
					</div>
					<div class="article-area cell large-auto">
						<div class="grid-y">
							<div class="head-area show-for-large">
								<div class="ch">貼身照顧</div>
								<div class="en">
									BEDSIDE<br>
									CARE
								</div>
							</div>
							<div class="content large-order-1 small-order-2">更貼近的照護，降低夜間起床的頻率，維護爸爸媽媽良好的睡眠品質。</div>
							<div class="title large-order-2 small-order-1">
								<ul class="title-list">
									<li></li>
									<li>拆卸護欄x4顆螺絲50mm</li>
									<li>取下床墊護條x2顆螺絲38mm</li>
									<li>收納護欄x4顆螺絲50mm</li>
									<li>調整高度</li>
									<li>固定床板x4顆螺絲38mm</li>
									<li>固定床墊護條x2顆螺絲38mm</li>
									<li></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</section>

			<section class="section">
				<div class="items-area grid-x">
					<div class="pic-area cell large-auto grid-x align-center-middle">
						<div class="head-area hide-for-large">
							<div class="ch">兒童床</div>
							<div class="en">
								KID BED
							</div>
						</div>
						<div class="pic">
							<div class="item">
								<div class="adjustments-slider"></div>
							</div>

							<ul class="adjustments-in-dots grid-x align-center-middle"></ul>

							<div class="prev"><img src="images/adjustments-prev.svg"></div>
							<div class="next"><img src="images/adjustments-next.svg"></div>
						</div>
					</div>
					<div class="article-area cell large-auto">
						<div class="grid-y">
							<div class="head-area show-for-large">
								<div class="ch">兒童床</div>
								<div class="en">
									KID<br>
									BED
								</div>
							</div>
							<div class="content large-order-1 small-order-2">大約18至24個月左右，寶寶活動力提升，不願意一直待在嬰兒床裡面，爸爸媽媽可以在周圍環境安全無虞情形下，調整成兒童床使用，給孩子更大、更自在的活動空間。</div>
							<div class="title large-order-2 small-order-1">
								<ul class="title-list">
									<li></li>
									<li>收納護欄x4顆螺絲50mm月</li>
									<li>收納床墊護條x2顆螺絲38mm</li>
									<li>固定床板x4顆螺絲38mm</li>
									<li></li>
								</ul>
							</div>
						</div>
					</div>
					<div class="note hide-for-large">
						<div class="title">注意事項</div>
						<div class="content">
							a.調整高度時，須使嬰兒床墊與爸媽的大床高度齊平或略低為原則。<br>
							b.注意固定好嬰兒床，在使用過程中，與大床之間不得出現的間隙，避免嬰兒翻落，夾傷。
						</div>
					</div>
				</div>
			</section>

			<section class="section fp-auto-height">
				<div class="items-area">
					<?php include 'footer.php'; ?>
				</div>
			</section>
		</main>
	</div>

</body>

<?php include 'script.php'; ?>
</html>

<script>
	if(device == 'desktop'){
		var $fullpage = $('#fullpage').fullpage({
			scrollBar: false,
			css3: false,
			scrollingSpeed: 1200,
			onLeave: function(origin, next, direction) {
				if (next == 1) {
					$(".adjustmentsCatsList").removeClass("is-show")

					$(".top").addClass("is-hide")
				}
				if (next == 2) {
					gsap.delayedCall(.5, function () {
						$(".adjustmentsCatsList").addClass("is-show")

						$(".top").removeClass("is-hide")
					});

					$(".adjustmentsCatsList li").eq(0).addClass("current").siblings().removeClass("current")
				}
				if (next == 3) {
					gsap.delayedCall(.5, function () {
						$(".adjustmentsCatsList").addClass("is-show")

						$(".top").removeClass("is-hide")
					});

					$(".adjustmentsCatsList li").eq(1).addClass("current").siblings().removeClass("current")
				}
				if (next == 4) {
					gsap.delayedCall(.5, function () {
						$(".adjustmentsCatsList").addClass("is-show")

						$(".top").removeClass("is-hide")
					});

					$(".adjustmentsCatsList li").eq(2).addClass("current").siblings().removeClass("current")
				}
				if (next == 5) {
					$(".adjustmentsCatsList").removeClass("is-show")

					$(".top").removeClass("is-hide")
				}
			},
		});

		$(".goto-one").on("click", function() {
			$.fn.fullpage.moveTo(2);
		})
		$(".goto-two").on("click", function() {
			$.fn.fullpage.moveTo(3);
		})
		$(".goto-three").on("click", function() {
			$.fn.fullpage.moveTo(4);
		})
		$(".top").on("click", function() {
			$.fn.fullpage.moveTo(1);
		})
	} else if(device == 'mobile'){
		$(".goto-one").on("click", function() {
			TweenMax.to($(window), 1.2, {
				scrollTo: {
					y: $("#fullpage section").eq(1),
					offsetY: $(window).height() * 0.05
				},
				ease:Power2.easeInOut,
				onComplete: function() {}
			})
		})
		$(".goto-two").on("click", function() {
			TweenMax.to($(window), 1.2, {
				scrollTo: {
					y: $("#fullpage section").eq(2),
					offsetY: $(window).height() * 0.05
				},
				ease:Power2.easeInOut,
				onComplete: function() {}
			})
		})
		$(".goto-three").on("click", function() {
			TweenMax.to($(window), 1.2, {
				scrollTo: {
					y: $("#fullpage section").eq(3),
					offsetY: $(window).height() * 0.05
				},
				ease:Power2.easeInOut,
				onComplete: function() {}
			})
		})
	}



	function RyderPixi(el, pics) {
		this.initScene = () => {
			this.renderer = new PIXI.autoDetectRenderer({
				transparent: true,
				width: $(el).width(),
				height: $(el).height(),
				antialias: true,
			});

			this.renderer.autoResize = true;

			$(el).append(this.renderer.view)
		}

		this.initStage = () => {
			this.stage = new PIXI.Container();
			this.container = new PIXI.Container();
			this.stage.addChild(this.container);
		}

		this.initProperty = () => {
			this.view_width = $(el).width();
			this.view_height = $(el).height();
			this.count = 0;
			this.now = 0;
			this.timer = null;

			this.sliders = []

			for (p of pics) {
				this.sliders.push(PIXI.Texture.from(p))

                $("<li></li>").appendTo( $(el).closest("section").find(".adjustments-in-dots") )
			}

            $(el).closest("section").find(".adjustments-in-dots").find("li").first().addClass("current")
		}

		this.initFilter = () => {

			const geometry = new PIXI.Geometry();
			geometry.addAttribute('aVertexPosition', [0, 0, this.view_width, 0, this.view_width, this.view_height, 0, this.view_height], 2);
			geometry.addAttribute('aUvs', [0, 0, 1, 0, 1, 1, 0, 1], 2).addIndex([0, 1, 2, 0, 2, 3]);

			const vertexSrc = `
				precision mediump float;

				attribute vec2 aVertexPosition;
				attribute vec2 aUvs;

				uniform mat3 translationMatrix;
				uniform mat3 projectionMatrix;

				varying vec2 vUvs;

				void main() {

					vUvs = aUvs;
					gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

				}
			`;

			const fragmentSrc = `
				precision mediump float;

				varying vec2 vUvs;

				uniform sampler2D uSampler2;
				uniform sampler2D uSampler3;


				uniform float time;
				uniform float progress;



				vec4 getFromColor(vec2 uv) {
					return texture2D(uSampler2, uv);
				}

				vec4 getToColor(vec2 uv) {
					return texture2D(uSampler3, uv);
				}




				uniform vec2 direction; // = vec2(1.0, -1.0)
				uniform float smoothness; // = 0.5

				const vec2 center = vec2(0.5, 0.5);

				vec4 transition (vec2 uv) {
				  vec2 v = normalize(direction);
				  v /= abs(v.x)+abs(v.y);
				  float d = v.x * center.x + v.y * center.y;
				  float m =
				    (1.0-step(progress, 0.0)) * // there is something wrong with our formula that makes m not equals 0.0 with progress is 0.0
				    (1.0 - smoothstep(-smoothness, 0.0, v.x * uv.x + v.y * uv.y - (d-0.5+progress*(1.+smoothness))));
				  return mix(getFromColor(uv), getToColor(uv), m);
				}



				void main() {

					vec2 uv = vUvs;

					gl_FragColor = transition(uv);
				}
			`;

			const uniforms = {
				uSampler2: this.sliders[0],
				uSampler3: this.sliders[1],
				time: 0,
				progress: 0,
				direction: [0, -1],
				smoothness: 1.1,
			};

			const shader = new PIXI.Shader.from(vertexSrc, fragmentSrc, uniforms);
			this.quad = new PIXI.Mesh(geometry, shader);

			this.container.addChild(this.quad);
		}

		this.render = () => {
			this.count += 0.01;

			this.quad.shader.uniforms.time += 0.02;
			// this.quad.shader.uniforms.progress = Math.abs( Math.sin(this.count) );

			this.renderer.render(this.stage);
			requestAnimationFrame(this.render);
		}

		this.init = () => {
			this.initScene()
			this.initStage()
			this.initProperty()
			this.initFilter()
			this.render()

			return this;
		}

		this.load = (i, prev) => {
			this.quad.shader.uniforms.progress = 0
			this.quad.shader.uniforms.uSampler2 = this.sliders[prev]
			this.quad.shader.uniforms.uSampler3 = this.sliders[i]

			gsap.to(this.quad.shader.uniforms, {
				duration: 2.5,
				'progress': 1,
				onComplete: () => {
					this.now = (this.now + 1 + this.sliders.length) % this.sliders.length
				}
			})
		}

		this.goto = (i, prev) => {
			this.quad.shader.uniforms.progress = 0
			this.quad.shader.uniforms.uSampler2 = this.sliders[prev]
			this.quad.shader.uniforms.uSampler3 = this.sliders[i]


			$(el).closest("section").find(".adjustments-in-dots").find("li").eq( i ).addClass("current").siblings().removeClass("current")

			gsap.to(this.quad.shader.uniforms, {
				duration: 2.5,
				'progress': 1,
				onComplete: () => {
					this.now = i
				}
			})
		}

		this.autoplay = (i) => {
			this.quad.shader.uniforms.progress = 0
			this.quad.shader.uniforms.uSampler2 = this.sliders[i]
			this.quad.shader.uniforms.uSampler3 = this.sliders[(i + 1 + this.sliders.length) % this.sliders.length]

			gsap.to(this.quad.shader.uniforms, {
				duration: 2.5,
				'progress': 1,
				onComplete: () => {
					this.now = (this.now + 1 + this.sliders.length) % this.sliders.length

					gsap.delayedCall(3, () => {
						this.autoplay(this.now)

                        // $(".adjustments-in-dots").eq( this.now ).addClass("current").siblings().removeClass("current")
					});
				}
			})
		}


		this.previous = () => {
			this.quad.shader.uniforms.progress = 0
			this.quad.shader.uniforms.uSampler2 = this.sliders[this.now]
			this.quad.shader.uniforms.uSampler3 = this.sliders[(this.now - 1 + this.sliders.length) % this.sliders.length]

			$(el).closest("section").find(".adjustments-in-dots").find("li").eq( (this.now - 1 + this.sliders.length) % this.sliders.length ).addClass("current").siblings().removeClass("current")
			$(el).closest("section").find(".title-list").find("li").eq( (this.now - 1 + this.sliders.length) % this.sliders.length ).addClass("current").siblings().removeClass("current")


			gsap.to(this.quad.shader.uniforms, {
				duration: 2.5,
				'progress': 1,
				onComplete: () => {
					this.now = (this.now - 1 + this.sliders.length) % this.sliders.length
				}
			})
		}
		this.next = () => {
			this.quad.shader.uniforms.progress = 0
			this.quad.shader.uniforms.uSampler2 = this.sliders[this.now]
			this.quad.shader.uniforms.uSampler3 = this.sliders[(this.now + 1 + this.sliders.length) % this.sliders.length]

			$(el).closest("section").find(".adjustments-in-dots").find("li").eq( (this.now + 1 + this.sliders.length) % this.sliders.length ).addClass("current").siblings().removeClass("current")
			$(el).closest("section").find(".title-list").find("li").eq( (this.now + 1 + this.sliders.length) % this.sliders.length ).addClass("current").siblings().removeClass("current")


			gsap.to(this.quad.shader.uniforms, {
				duration: 2.5,
				'progress': 1,
				onComplete: () => {
					this.now = (this.now + 1 + this.sliders.length) % this.sliders.length
				}
			})
		}
	}

	var _tls = [];
	$(".adjustments-slider").each(function(i, el) {
		let rydergl;
		if(i == 0){
			var pics = [
				'images/adjustments-0.jpg',
				'images/adjustments-1.jpg',
			];
			
		}
		if(i == 1){
			var pics = [
				'images/adjustments-2.jpg',
				'images/adjustments-3.jpg',
				'images/adjustments-2.jpg',
				'images/adjustments-3.jpg',
				'images/adjustments-2.jpg',
				'images/adjustments-3.jpg',
				'images/adjustments-2.jpg',
				'images/adjustments-3.jpg',
			];
			
		}
		if(i == 2){
			var pics = [
				'images/adjustments-4.jpg',
				'images/adjustments-5.jpg',
				'images/adjustments-4.jpg',
				'images/adjustments-5.jpg',
				'images/adjustments-4.jpg',
				'images/adjustments-5.jpg',
				'images/adjustments-4.jpg',
				'images/adjustments-5.jpg',
			];
		}
		if(i == 3){
			var pics = [
				'images/adjustments-6.jpg',
				'images/adjustments-7.jpg',
				'images/adjustments-6.jpg',
				'images/adjustments-7.jpg',
				'images/adjustments-6.jpg',
			];
		}
		
		rydergl = new RyderPixi($(el), pics).init()

		_tls.push(rydergl)
	})

	$(function() {
		gsap.delayedCall(.25, function () {
			_tls[0].load(1, 0)
		})
	});

	

	var _changing = true
	$(".adjustments-slider").closest("section").find(".prev").on("click", function(){
		var _this = $(this).closest("section").index()

		if(_changing){
			_changing = false

			_tls[_this].previous()

			gsap.delayedCall(2.5, function () {
				_changing = true
			})
		}
	})
	$(".adjustments-slider").closest("section").find(".next").on("click", function(){
		var _this = $(this).closest("section").index()

		if(_changing){
			_changing = false

			_tls[_this].next()

			gsap.delayedCall(2.5, function () {
				_changing = true
			})
		}
	})

	// $(".adjustments-slider").closest("section").find(".adjustments-in-dots").find("li").on("click", function(){
	// 	var _this = $(this).closest("section").index() - 1

	// 	var _next = $(this).index()
	// 	var _prev = $(this).closest("ul").find(".current").index()

	// 	if(_changing){
	// 		_changing = false

	// 		_tls[_this].goto(_next, _prev)
			
	// 		gsap.delayedCall(3, function () {
	// 			_changing = true
	// 		})
	// 	}
	// })
</script>